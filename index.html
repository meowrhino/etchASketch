<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <style>
        .grid {
            display: flex;
            flex-wrap: wrap;
        }

        .cell {
            width: 25px;
            height: 25px;
            background-color: lightgray;
        }
    </style>
    <title>Etch a Sketch</title>
</head>

<body>
    <div class="container">
        <div class="grid"></div>
    </div>


    <script>
        const container = document.querySelector(".container");
        const grid = document.querySelector(".grid");

        let gridLenght = 16;
        createGrid();
        let newGridLenght = 0;



        const button = document.createElement('button');
        button.classList.add('gridLenghtInput');
        button.textContent = "change grid size";
        button.onclick = function () { newGridLenght = +prompt("how much definition would u like?"); console.log(newGridLenght); updateGrid(); };
        container.appendChild(button);

        function updateGrid() {
            console.log("updateGrid was called");
            if (newGridLenght > 0) {
                if (newGridLenght > 100) {
                    alert("that's too much! must be an integer below 100")
                } else {
                    gridLenght = newGridLenght;
                    createGrid();
                }
            } else {
                alert("grid lenght input must be an integer between 1 and 99")
            }
        }

        function createGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < gridLenght; i++) {
                for (let j = 0; j < gridLenght; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.style.opacity = 0.1;
                    grid.appendChild(cell);

                    cell.addEventListener("mouseover", function (e) {
                        var a = cell.style.backgroundColor;

                        if (typeof a === "string" && a.length === 0) {
                            console.log("The string is empty");
                            var newColor = random_hsl();
                            cell.style.backgroundColor = newColor;
                        } else {
                            let oldColor = cell.style.backgroundColor
                            console.log(oldColor);

                            let r1 = oldColor.split('(');
                            let r2 = r1[1].split(',');

                            let oldR = r2[0];
                            let oldG = r2[1];
                            let oldB_ = r2[2];
                            let oldB = oldB_.slice(0, -1);
                            
                            let testHSL = rgbToHsl(oldR, oldG, oldB);
                            
                            let newColor = `hsl(${testHSL[0]}, ${testHSL[1]}%, ${testHSL[2]}%)` 
                            
                            console.log(newColor);
                            cell.style.backgroundColor = newColor;
                        }


                        //y el caso en que el color sea un color en formato HSL
                        //en cuyo caso tienes que conseguir la informacion de la L
                        //si es > 0, restarle 10
                        //y recomponer el string del color para volver a darselo
                        //o sea obtienes el string
                        //obtienes la L del string
                        //consigues la nueva L
                        //y recompones el string sustituyedno la vieja L por la nueva
                        /*colorLightness = +newColor.substr(-5, 3);
                        console.log(colorLightness);

                        if (colorLightness > 0) {
                            colorLightness = colorLightness - 10;
                            console.log('new lightness is ' + colorLightness)
                        }
                        */
                    })
                }
            }
            grid.style.width = `${25 * gridLenght}px`;
            grid.style.height = `${25 * gridLenght}px`;
        }

        function random_hsl() {
            var h = Math.floor(Math.random() * 255);
            return `hsl(${h}, 100%, 100%)`
        }

        function rgbToHsl(r, g, b) {
            r /= 255, g /= 255, b /= 255;
            console.log(b);

            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h, s, l = (max + min) / 2;

            if (max == min) {
                h = s = 0; // achromatic
            } else {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }

                h /= 6;
            }

            return [h, s, l];
        }


    </script>

</body>

</html>