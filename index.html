<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>etchASketch</title>

    <style>
        .yellow {
            background-color: yellow;
        }

        .gray,
        .one {
            background-color: gray;
        }

        .clicked {
            background-color: greenyellow;
        }

        .cursed {
            background-color: lightgray;
        }

        .orange {
            background-color: orangered;
        }

        .darkOrange {
            background-color: gold;
        }

        .exploded {
            background-color: darkred;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        html,
        body,
        .container {
            height: 100%;
        }

        .etchASketch {
            cursor: none;
            width: 600px;
            height: 600px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="etchASketch">
        </div>

        <button class="gridLenghtBtn">
            change number of squares per side
        </button>
    </div>

    <script>
        const container = document.querySelector(".container");
        const etchASketch = document.querySelector(".etchASketch");
        const gridLenghtBtn = document.querySelector(".gridLenghtBtn");

        gridLenghtBtn.addEventListener('click', () => {
            gridLenght = +prompt("what number of squares per side would you like?");
            updateGrid();
        });

        let gridLenght = 8;
        createGrid();

        function updateGrid() {

            if (gridLenght > 0) {
                if (gridLenght > 100) {
                    alert("that's too much! must be an integer below 100")
                } else if (gridLenght == null) {
                    alert("you've cancelled the change")
                }

                else {
                    gridLenght = gridLenght;
                    createGrid();
                }
            } else {
                alert("grid lenght input must be an integer between 1 and 99")
            }
        }

        function createGrid() {

            etchASketch.innerHTML = '';

            for (let i = 0; i < gridLenght; i++) {

                /*generamos las rows donde irán los cuadrados, que han de ser flex para que se pongan los cuadrados en linea uno tras otro*/
                let rowDiv = document.createElement("div");
                rowDiv.id = `row${i}`;
                rowDiv.style.display = "flex";


                for (let j = 0; j < gridLenght; j++) {

                    /*y creamos los cuadrados, que por defecto serán grises*/
                    let squareDiv = document.createElement("div");
                    squareDiv.classList.add("gray");

                    /*calculamos cómo de grande han de ser*/
                    const sizeOfSquare = etchASketchWidth = etchASketch.offsetWidth / gridLenght;
                    squareDiv.style.height = `${sizeOfSquare}px`;
                    squareDiv.style.width = `${sizeOfSquare}px`;

                    /*y les damos un ID a cada uno (para más tarde hacer algunos bomba)
                    el id es su numero en la fila */
                    squareDiv.id = i * gridLenght + j;

                    /*pero si les pasa el cursor por encima se convertirán en amarillos*/
                    squareDiv.addEventListener('mouseover', () => {
                        if (squareDiv.classList.contains("gray")) {
                            squareDiv.classList.remove("gray");
                            squareDiv.classList.add("yellow");
                        } else if (squareDiv.classList.contains("one")) {
                            squareDiv.classList.remove("one");
                            squareDiv.classList.add("orange");
                        } else if (squareDiv.classList.contains("orange")) {
                            squareDiv.classList.remove("orange");
                            squareDiv.classList.add("darkOrange");
                        }
                    });

                    /*y cuando el cursor se vaya, volverán a ser grises*/
                    squareDiv.addEventListener('mouseout', () => {
                        if (squareDiv.classList.contains("clicked")) {

                        } else if (squareDiv.classList.contains("yellow")) {
                            squareDiv.classList.remove("yellow");
                            squareDiv.classList.add("gray");
                        } else if (squareDiv.classList.contains("darkOrange")) {
                            squareDiv.classList.remove("darkOrange");
                            squareDiv.classList.add("orange");
                        }

                    });

                    /*y si se les hace click se ponen verde o rojos, segun esten cursed o no*/
                    squareDiv.addEventListener('click', () => {

                        if (squareDiv.classList.contains("cursed")) {
                            squareDiv.classList.remove("cursed");
                            squareDiv.classList.add("exploded");
                        }

                        squareDiv.classList.remove("yellow");
                        squareDiv.classList.add("clicked");
                    });


                    rowDiv.appendChild(squareDiv)
                }

                etchASketch.appendChild(rowDiv);
            }

            {
                /*y ahora curseamos un square*/
                /*DRAMA: si el cursed square es el 8, o si es el 1, creo que no va bien :(*/
                //const cursedSquareId = curseSquares(gridLenght);
                const cursedSquareId = 8;
                const cursedSquare = document.getElementById(cursedSquareId);
                cursedSquare.classList.remove("gray");
                cursedSquare.classList.add("cursed");

                /*y marcamos los cuadrados que lo rodean*/
                markNearSquares(cursedSquareId);
            }
        }

        function curseSquares() {
            const totalSquares = gridLenght * gridLenght;
            const cursedSquare = randomNumber(0, totalSquares);
            return cursedSquare;
        }

        function markNearSquares(cursedSquareId) {

            /*el cuadrado superior y los del lado*/
            const squareUpId = cursedSquareId - gridLenght;
            const squareDiagonal1Id = squareUpId - 1;
            const squareDiagonal2Id = squareUpId + 1;

            if (squareUpId >= 0) {
                const squareUp = document.getElementById(squareUpId);
                squareUp.classList.remove("gray");
                squareUp.classList.add("one");

                /*y el cuadrado de la esquina arriba izquierda*/
                changeInto1(squareDiagonal1Id, cursedSquareId);
                /*

                const checkSquareD1 = verifySquare(squareDiagonal1Id);

                if (checkSquareD1 === 1 || checkSquareD1 === 2) {

                    if (cursedSquareId % gridLenght === 1) {
                        const squareDiagonal1 = document.getElementById(squareDiagonal1Id);
                        squareDiagonal1.classList.remove("gray");
                        squareDiagonal1.classList.add("one");
                    }
                }

                else if (squareDiagonal1Id >= 0) {
                    const squareDiagonal1 = document.getElementById(squareDiagonal1Id);
                    squareDiagonal1.classList.remove("gray");
                    squareDiagonal1.classList.add("one");
                }
                    */

                /*y el cuadrado de la esquina arriba derecha*/
                changeInto1(squareDiagonal2Id, cursedSquareId); /*
                const checkSquareD2 = verifySquare(squareDiagonal2Id);

                if (checkSquareD2 === 1 || checkSquareD2 === 2) {

                    if (cursedSquareId % gridLenght === gridLenght - 2) {
                        const squareDiagonal2 = document.getElementById(squareDiagonal2Id);
                        squareDiagonal2.classList.remove("gray");
                        squareDiagonal2.classList.add("one");
                    }
                }

                else {
                    const squareDiagonal2 = document.getElementById(squareDiagonal2Id);
                    squareDiagonal2.classList.remove("gray");
                    squareDiagonal2.classList.add("one");
                }
                */

            }



            /*y el cuadrado a la izquierda*/
            const squareLeftToId = cursedSquareId - 1;
            const checkSquareLeft = verifySquare(squareLeftToId);

            if (checkSquareLeft === 1 || checkSquareLeft === 2) {

                if (cursedSquareId % gridLenght === 1) {
                    const squareLeft = document.getElementById(squareLeftToId);
                    squareLeft.classList.remove("gray");
                    squareLeft.classList.add("one");
                }
            }

            else {
                const squareLeft = document.getElementById(squareLeftToId);
                squareLeft.classList.remove("gray");
                squareLeft.classList.add("one");
            }



            /*y el cuadrado a la derecha*/
            const squareRightToId = cursedSquareId + 1;
            const checkSquareRight = verifySquare(squareRightToId);


            if (checkSquareRight === 1 || checkSquareRight === 2) {

                if (cursedSquareId % gridLenght === gridLenght - 2) {
                    const squareRight = document.getElementById(squareRightToId);
                    squareRight.classList.remove("gray");
                    squareRight.classList.add("one");
                }
            }

            else {
                const squareRight = document.getElementById(squareRightToId);
                squareRight.classList.remove("gray");
                squareRight.classList.add("one");
            }



            /*el cuadrado inferior y los del lado*/
            const squareDownId = cursedSquareId + gridLenght;
            const squareDiagonal3Id = squareDownId - 1;
            const squareDiagonal4Id = squareDownId + 1;

            if (squareDownId < gridLenght * gridLenght) {
                const squareDown = document.getElementById(squareDownId);
                squareDown.classList.remove("gray");
                squareDown.classList.add("one");

                /*y el cuadrado de la esquina abajo izquierda*/
                const checkSquareD3 = verifySquare(squareDiagonal3Id);

                if (checkSquareD3 === 1 || checkSquareD3 === 2) {

                    if (cursedSquareId % gridLenght === 1) {
                        const squareDiagonal3 = document.getElementById(squareDiagonal3Id);
                        squareDiagonal3.classList.remove("gray");
                        squareDiagonal3.classList.add("one");
                    }
                }

                else {
                    const squareDiagonal3 = document.getElementById(squareDiagonal3Id);
                    squareDiagonal3.classList.remove("gray");
                    squareDiagonal3.classList.add("one");
                }

                /*y el cuadrado de la esquina abajo derecha*/
                const checkSquareD4 = verifySquare(squareDiagonal4Id);

                if (checkSquareD4 === 1 || checkSquareD4 === 2) {

                    if (cursedSquareId % gridLenght === gridLenght - 2) {
                        const squareDiagonal4 = document.getElementById(squareDiagonal4Id);
                        squareDiagonal4.classList.remove("gray");
                        squareDiagonal4.classList.add("one");
                    }
                }

                else {
                    const squareDiagonal4 = document.getElementById(squareDiagonal4Id);
                    squareDiagonal4.classList.remove("gray");
                    squareDiagonal4.classList.add("one");
                }


            }
        }

        function verifySquare(squareToCheckId) {

            console.log(`squareToCheckId is ${squareToCheckId}`);

            if (squareToCheckId % gridLenght == 0) {
                return 1;
            }
            else if (squareToCheckId % gridLenght == gridLenght - 1) {
                return 2;
            }
            else if (squareToCheckId % gridLenght == 1) {
                return 3;
            }
            else if (squareToCheckId % gridLenght == gridLenght - 2) {
                return 4;
            }

            else {
                return false;
            }
        }

        function changeInto1(squareId, cursed) {

            const checkSquare = verifySquare(squareId);
            const square = document.getElementById(squareId);

            if (checkSquare === 1 || checkSquare === 2) {

                if (cursed % gridLenght === 1) {
                    square.classList.remove("gray");
                    square.classList.add("one");
                }
            }

            else if (squareId >= 0) {
                const square = document.getElementById(squareId);
                square.classList.remove("gray");
                square.classList.add("one");
            }

        }


        function randomNumber(min, max) {
            return Math.floor(Math.random() * (max - min) + min);
        }

    </script>

</body>

</html>
